{"paragraphs":[{"text":"%md\n# Pre-processing game log\n\nWe have to pre-process game log to specific format. We will use We will use logs of the types listed below.\n\n## Log type we used\n* PCLevelUp(1013)\n    * PCLevel(min,max)\n    * MasteryLevel(min,max)\n* JoinParty(1102) : count\n* GetItem(1022) : count\n* KillPC(1209) : count\n* Die(1202) : count","user":"anonymous","dateUpdated":"2017-11-07T01:42:36+0900","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Pre-processing game log</h1>\n<p>We have to pre-process game log to specific format. We will use We will use logs of the types listed below.</p>\n<h2>Log type we used</h2>\n<ul>\n  <li>PCLevelUp(1013)\n    <ul>\n      <li>PCLevel(min,max)</li>\n      <li>MasteryLevel(min,max)</li>\n    </ul>\n  </li>\n  <li>JoinParty(1102) : count</li>\n  <li>GetItem(1022) : count</li>\n  <li>KillPC(1209) : count</li>\n  <li>Die(1202) : count</li>\n</ul>\n</div>"}]},"apps":[],"jobName":"paragraph_1509982150399_1013722248","id":"20171107-002910_866868944","dateCreated":"2017-11-07T00:29:10+0900","dateStarted":"2017-11-07T01:42:36+0900","dateFinished":"2017-11-07T01:42:36+0900","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4665"},{"text":"//Setting log directory\n//You have to change PROJECT_HOME\nval PROJECT_HOME=\"/Users/leeyh0216/Documents/projects/bns_churn_prediction\"\nval gamelogDir = s\"$PROJECT_HOME/data/gamelog\"\n\nval df = spark.sqlContext.read\n    .format(\"com.databricks.spark.csv\")\n    .option(\"header\", \"true\")\n    .option(\"inferSchema\", \"true\")\n    .load(s\"$gamelogDir/1*.csv\")\n\nval aggDf = df.withColumn(\"time\", date_format(col(\"time\"), \"yyyy-MM-dd\")).groupBy(\"actor_account_id\",\"time\")\nval logCntDf = aggDf.agg(count(\"*\").as(\"logCnt\"))\nlogCntDf.registerTempTable(\"logCntDf\")\nval maxLevelDf = aggDf.agg(max(col(\"actor_level\")).as(\"maxLevel\"))\nmaxLevelDf.registerTempTable(\"maxLevelDf\")\nval maxMasteryLevelDf = aggDf.agg(max(col(\"actor_masterylevel\")).as(\"maxMasteryLevel\"))\nmaxMasteryLevelDf.registerTempTable(\"maxMasteryLevelDf\")\nval partyCntDf = aggDf.agg(count(when($\"logid\" === 1102, true)).as(\"partyCnt\"))\npartyCntDf.registerTempTable(\"partyCntDf\")\nval killCntDf = aggDf.agg(count(when($\"logid\" === 1209, true)).as(\"killCnt\"))\nkillCntDf.registerTempTable(\"killCntDf\")\nval deadCntDf = aggDf.agg(count(when($\"logid\" === 1202, true)).as(\"deadCnt\"))\ndeadCntDf.registerTempTable(\"deadCntDf\")\n\nval resultDf = spark.sqlContext.sql(\n    \"\"\"select a.time as time, a.actor_account_id as actor_account_id,a.logCnt as logCnt, b.maxLevel as maxLevel, c.maxMasteryLevel as maxMasteryLevel, d.partyCnt as partyCnt, e.killCnt as killCnt, f.deadCnt as deadCnt\n        from logCntDf a inner join maxLevelDf b on a.time=b.time and a.actor_account_id=b.actor_account_id\n        inner join maxMasteryLevelDf c on a.time=c.time and a.actor_account_id=c.actor_account_id\n        inner join partyCntDf d on a.time=d.time and a.actor_account_id=d.actor_account_id\n        inner join killCntDf e on a.time=e.time and a.actor_account_id=e.actor_account_id\n        inner join deadCntDf f on a.time=f.time and a.actor_account_id=f.actor_account_id\n    \"\"\")","user":"anonymous","dateUpdated":"2017-11-07T02:33:52+0900","config":{"colWidth":12,"enabled":true,"results":{"1":{"graph":{"mode":"lineChart","height":300,"optionOpen":true,"setting":{"lineChart":{}},"commonSetting":{},"keys":[{"name":"time","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"deadCnt","index":7,"aggr":"sum"},{"name":"maxLevel","index":2,"aggr":"sum"},{"name":"maxMasteryLevel","index":3,"aggr":"sum"},{"name":"logCnt","index":4,"aggr":"sum"},{"name":"partyCnt","index":5,"aggr":"sum"},{"name":"killCnt","index":6,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"PROJECT_HOME: String = /Users/leeyh0216/Documents/projects/bns_churn_prediction\ngamelogDir: String = /Users/leeyh0216/Documents/projects/bns_churn_prediction/data/gamelog\ndf: org.apache.spark.sql.DataFrame = [seq: int, time: timestamp ... 73 more fields]\naggDf: org.apache.spark.sql.RelationalGroupedDataset = org.apache.spark.sql.RelationalGroupedDataset@2e8d67d7\nlogCntDf: org.apache.spark.sql.DataFrame = [actor_account_id: string, time: string ... 1 more field]\nwarning: there was one deprecation warning; re-run with -deprecation for details\nmaxLevelDf: org.apache.spark.sql.DataFrame = [actor_account_id: string, time: string ... 1 more field]\nwarning: there was one deprecation warning; re-run with -deprecation for details\nmaxMasteryLevelDf: org.apache.spark.sql.DataFrame = [actor_account_id: string, time: string ... 1 more field]\nwarning: there was one deprecation warning; re-run with -deprecation for details\npartyCntDf: org.apache.spark.sql.DataFrame = [actor_account_id: string, time: string ... 1 more field]\nwarning: there was one deprecation warning; re-run with -deprecation for details\nkillCntDf: org.apache.spark.sql.DataFrame = [actor_account_id: string, time: string ... 1 more field]\nwarning: there was one deprecation warning; re-run with -deprecation for details\ndeadCntDf: org.apache.spark.sql.DataFrame = [actor_account_id: string, time: string ... 1 more field]\nwarning: there was one deprecation warning; re-run with -deprecation for details\nresultDf: org.apache.spark.sql.DataFrame = [time: string, actor_account_id: string ... 6 more fields]\n"}]},"apps":[],"jobName":"paragraph_1509981131758_1278376940","id":"20171107-001211_103261054","dateCreated":"2017-11-07T00:12:11+0900","dateStarted":"2017-11-07T02:33:52+0900","dateFinished":"2017-11-07T02:35:43+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4666"},{"text":"z.show(resultDf.filter($\"actor_account_id\"===\"132FA4D3\").select(\"time\",\"maxLevel\",\"maxMasteryLevel\",\"logCnt\",\"partyCnt\",\"killCnt\",\"deadCnt\").sort(asc(\"time\")))","user":"anonymous","dateUpdated":"2017-11-07T02:48:37+0900","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"lineChart","height":1121,"optionOpen":true,"setting":{"lineChart":{"lineWithFocus":true}},"commonSetting":{},"keys":[{"name":"time","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"killCnt","index":5,"aggr":"sum"},{"name":"partyCnt","index":4,"aggr":"sum"},{"name":"deadCnt","index":6,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"time\tmaxLevel\tmaxMasteryLevel\tlogCnt\tpartyCnt\tkillCnt\tdeadCnt\n2016-04-08\t50\t11\t4876\t30\t18\t78\n2016-04-09\t50\t11\t8294\t20\t38\t22\n2016-04-10\t50\t11\t6382\t30\t24\t14\n2016-04-11\t50\t11\t5296\t30\t20\t84\n2016-04-12\t50\t12\t8368\t12\t32\t12\n2016-04-13\t50\t12\t8992\t46\t34\t84\n2016-04-14\t50\t12\t5806\t24\t8\t16\n2016-04-15\t50\t12\t9910\t32\t22\t56\n2016-04-16\t50\t12\t3214\t6\t4\t38\n2016-04-17\t50\t12\t12528\t38\t2\t28\n2016-04-18\t50\t12\t8432\t30\t24\t58\n2016-04-19\t50\t12\t5132\t10\t0\t14\n2016-04-22\t50\t12\t1586\t18\t10\t30\n2016-04-23\t50\t12\t9174\t28\t28\t18\n2016-04-24\t50\t12\t10988\t38\t8\t18\n2016-04-29\t50\t12\t1020\t10\t14\t6\n2016-04-30\t50\t12\t12090\t32\t28\t58\n2016-05-01\t50\t12\t6308\t30\t6\t10\n2016-05-05\t50\t12\t5562\t0\t0\t8\n2016-05-07\t50\t12\t9556\t16\t0\t2\n2016-05-08\t50\t12\t4412\t6\t0\t4\n"}]},"apps":[],"jobName":"paragraph_1509981140756_2023650884","id":"20171107-001220_1618124505","dateCreated":"2017-11-07T00:12:20+0900","dateStarted":"2017-11-07T02:36:18+0900","dateFinished":"2017-11-07T02:44:25+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4667"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1509986898637_-1453421052","id":"20171107-014818_346822867","dateCreated":"2017-11-07T01:48:18+0900","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:4668"}],"name":"gamelog_aggregation","id":"2CXZTGS19","angularObjects":{"2CZQ929U1:shared_process":[],"2CZ2BP9YT:shared_process":[],"2D13ZNWTZ:shared_process":[],"2CZ664G9R:shared_process":[],"2D13ZRY18:shared_process":[],"2CYCGTMNX:shared_process":[],"2CX1Q558A:shared_process":[],"2CZUMJG36:shared_process":[],"2CYSMCYZD:shared_process":[],"2CZ9BKJ7J:shared_process":[],"2D16W85TB:shared_process":[],"2CXCMVV9G:shared_process":[],"2CZTPFH3E:shared_process":[],"2CZXBZRG8:shared_process":[],"2CY17A9BR:shared_process":[],"2CWYDQABW:shared_process":[],"2CZ3NBJHK:shared_process":[],"2CZMGTJ4P:shared_process":[],"2CZG82XFJ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}